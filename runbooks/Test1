[{"name":"Example: Restart DB2 instance","description":"Restart a DB2 instance on Linux","steps":[{"title":"Disclaimer","number":1,"type":"manual","description":"<p>This runbook provides an example for illustrative purposes. Feel free to create a copy of this runbook and adjust the steps in your copy as needed in your environment. Then you can remove this step and publish the runbook.</p>"},{"number":2,"description":"<p>Login to system <span class=\"rba-parameter\" data-id=\"HOSTNAME\"></span>as the DB2 instance owner:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">ssh <span class=\"rba-parameter\" data-id=\"DB2INSTANCE\"></span>@<span class=\"rba-parameter\" data-id=\"HOSTNAME\"></span></span></section><p>&nbsp;</p>","title":"Login as DB2 instance owner","type":"manual"},{"number":3,"description":"<p>Run the command below to determine whether the DB2 process is running:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">db2_local_ps</span></section><p>&nbsp;</p><p>If the result returns a list with an active process where UID is <span class=\"rba-parameter\" data-id=\"DB2INSTANCE\"></span>and CMD is db2sysc, your instance is running. See the output below for an example:</p><p>db2inst1@db2server:~&gt; db2_local_ps<br>Node 0<br>&nbsp;&nbsp;&nbsp;&nbsp; UID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PPID&nbsp;&nbsp;&nbsp; C&nbsp;&nbsp;&nbsp;&nbsp; STIME&nbsp;&nbsp;&nbsp;&nbsp; TTY&nbsp;&nbsp;&nbsp;&nbsp; TIME CMD<br>db2inst1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26545&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 04:31:37 db2sysc<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26548&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26549&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26550&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd</p><p>If the result does not contain active processes, DB2 is not running, proceed with <span class=\"rba-goto\" data-id=\"step6\"></span>. The output below shows an example for such a case:</p><p>db2inst1@saxb58a:~&gt; db2_local_ps<br>Node 0<br>&nbsp;&nbsp;&nbsp;&nbsp; UID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PPID&nbsp;&nbsp;&nbsp; C&nbsp;&nbsp;&nbsp;&nbsp; STIME&nbsp;&nbsp;&nbsp;&nbsp; TTY&nbsp;&nbsp;&nbsp;&nbsp; TIME CMD</p>","title":"Determine whether DB2 is running","type":"manual"},{"number":4,"description":"<p>Run the following command:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">db2 force applications all; sleep 20; db2 terminate; db2stop; db2licd -end; ipclean -a</span></section><p>&nbsp;</p>","title":"Stop the running DB2 instance","type":"manual"},{"number":5,"description":"<p>Run the command:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">ls ~/sqllib/</span></section><p>&nbsp;</p><p>If it shows the content of a folder, the directory exists. If not it is missing and the DB2 instance cannot be started. Escalate this issue to the next support level, providing the log of this runbook.</p>","title":"Check existence of sqllib folder","type":"manual"},{"number":6,"description":"<p>Check whether the DB2 instance is a single partition DB2:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">grep -v \"^[ ]*$\" ~/sqllib/db2nodes.cfg | wc -l | awk '{print span-grp }'</span></section><p>&nbsp;</p><p>If this command returns 1, you have a single partition DB2. In case of a single partition DB2, perform an IPC Cleanup:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">~/sqllib/bin/ipclean -a</span></section><p>&nbsp;</p>","title":"Perform an IPC cleanup","type":"manual"},{"number":7,"description":"<p>Run the command:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">db2start</span></section><p>&nbsp;</p><p>The output should show the message: SQL1063N&nbsp; DB2START processing was successful.</p>","title":"Start the DB2 instance","type":"manual"},{"number":8,"description":"<p>Run the command:</p><p>&nbsp;</p><section class=\"rba-command\"><span class=\"rba-command-text\">db2_local_ps</span></section><p>&nbsp;</p><p>If the result returns a list with an active process where UID is <span class=\"rba-parameter\" data-id=\"DB2INSTANCE\"></span>and CMD is db2sysc, your instance is running. You can <span class=\"rba-goto\" data-id=\"end\"></span>the runbook now. See the output below for an example:</p><p>db2inst1@db2server:~&gt; db2_local_ps<br>Node 0<br>&nbsp;&nbsp;&nbsp;&nbsp; UID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PPID&nbsp;&nbsp;&nbsp; C&nbsp;&nbsp;&nbsp;&nbsp; STIME&nbsp;&nbsp;&nbsp;&nbsp; TTY&nbsp;&nbsp;&nbsp;&nbsp; TIME CMD<br>db2inst1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26545&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 04:31:37 db2sysc<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26548&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26549&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd<br>&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26550&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26547&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? 00:00:00 db2ckpwd</p><p>If the result does not contain active processes, DB2 is not running, yet. Wait for 60 seconds and then repeat the command. If DB2 is still not running, escalate this to the next service level.</p>","title":"Determine whether DB2 is running","type":"manual"}],"parameters":[{"name":"HOSTNAME","description":"Hostname where DB2 is running","type":"string","minLength":1},{"name":"DB2INSTANCE","description":"DB2 instance name","type":"string","minLength":1}],"tags":["linux","database","db2","sample"]}]
